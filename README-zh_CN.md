![](https://i.loli.net/2019/03/24/5c973b70e65b3.png)
![](https://img.shields.io/npm/v/node-process-pool.svg)![](https://img.shields.io/npm/dw/node-process-pool.svg)![](https://img.shields.io/bundlephobia/min/node-process-pool.svg)![](https://img.shields.io/npm/l/node-process-pool.svg)

[English](./README.md) | ç®€ä½“ä¸­æ–‡

#### ğŸ–¥ èƒŒæ™¯

Nodeæ˜¯å•çº¿ç¨‹æ¨¡å‹ï¼Œå½“éœ€è¦æ‰§è¡Œå¤šä¸ªç‹¬ç«‹ä¸”è€—æ—¶ä»»åŠ¡çš„æ—¶å€™ï¼Œåªèƒ½é€šè¿‡child_processæ¥åˆ†å‘ä»»åŠ¡ï¼Œæé«˜å¤„ç†é€Ÿåº¦ï¼›ä¸åƒJavaè¿™ç§å¤šçº¿ç¨‹è¯­è¨€ï¼Œå¯ä»¥é€šè¿‡çº¿ç¨‹æ¥è§£å†³å¹¶è¡Œé—®é¢˜ï¼ŒNodeåªèƒ½åˆ›å»ºè¿›ç¨‹æ¥è¿›è¡Œå¤„ç†ï¼›ä½†æ˜¯è¿›ç¨‹ç›¸å¯¹äºçº¿ç¨‹æ¥è¯´ï¼Œå¼€é”€å¤ªå¤§ã€‚ä¸€æ—¦è¿›ç¨‹æ•°è¾ƒå¤šæ—¶ï¼ŒCPUå’Œå†…å­˜æ¶ˆè€—ä¸¥é‡ï¼ˆå½±å“æˆ‘å¹²å…¶ä»–çš„äº‹æƒ…ï¼‰ï¼Œæ‰€ä»¥åšäº†ä¸€ä¸ªç®€æ˜“ç‰ˆçš„è¿›ç¨‹æ± ï¼Œç”¨æ¥è§£å†³å¹¶è¡Œä»»åŠ¡çš„å¤„ç†ã€‚

é€‚ç”¨åœºæ™¯ï¼šç›¸åŒä¸”ç‹¬ç«‹ä¸”è€—æ—¶çš„ä»»åŠ¡ï¼Œä¾‹å¦‚ï¼Œæ‹¿åˆ°æŸç½‘ç«™1000ä¸ªç”¨æˆ·çš„è´¦å·å¯†ç ï¼Œæˆ‘ç°åœ¨æƒ³è¦ä»–ä»¬çš„ä¿¡æ¯ï¼Œçˆ¬ä»–ï¼Œnode-process-pooléå¸¸é€‚åˆã€‚

#### ğŸ¤”æ€è·¯

ä¸»æ§è¿›ç¨‹+å·¥ä½œè¿›ç¨‹ç¾¤

ProcessPoolæ˜¯æˆ‘ä»¬ç®¡ç†è¿›ç¨‹çš„åœ°æ–¹ï¼Œæˆ‘ä»¬é€šè¿‡ä¼ é€’é…ç½®å‚æ•°ï¼ˆä»»åŠ¡è„šæœ¬ã€è„šæœ¬éœ€è¦çš„å‚æ•°ã€æœ€å¤§å¹¶è¡Œè¿›ç¨‹æ•°ï¼‰ç”Ÿæˆä¸€ä¸ªProcessPoolå®ä¾‹ï¼Œç„¶åé€šè¿‡è¿™ä¸ªå®ä¾‹æ¥ç®¡æ§è¿›ç¨‹æ± ã€‚

ProcessItemæ˜¯æˆ‘ä»¬è¿›ç¨‹æ± é‡Œçš„è¿›ç¨‹å¯¹è±¡ï¼ŒProcessItemå¯¹è±¡é™¤äº†processçš„ä¿¡æ¯ï¼Œæˆ‘ä»¬è¿˜å¢åŠ äº†å”¯ä¸€æ ‡è¯†å’ŒçŠ¶æ€ï¼ˆå¿™ç¢Œã€ä»»åŠ¡å¤±è´¥ã€ä»»åŠ¡å®Œæˆã€è¿›ç¨‹ä¸å¯ç”¨ï¼‰ã€‚

ä¸€æ‰¹ä»»åŠ¡å¼€å§‹æ—¶ï¼Œæˆ‘ä»¬ä¼šä¸€æ¬¡æ€§forkåˆ°æœ€å¤§å¹¶è¡Œè¿›ç¨‹æ•°ï¼Œç„¶åå¼€å§‹ç›‘æ§æ˜¯å¦æœ‰å·¥ä½œè¿›ç¨‹å®Œæˆä»»åŠ¡ï¼Œå¦‚æœæœ‰å·¥ä½œè¿›ç¨‹å®Œæˆäº†ä»»åŠ¡ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥å¤ç”¨è¿™ä¸ªå·¥ä½œè¿›ç¨‹ï¼Œè®©å…¶æ‰§è¡Œæ–°ä»»åŠ¡ï¼›å¦‚æœä»»åŠ¡æ‰§è¡Œå¤±è´¥ï¼Œæˆ‘ä»¬ä¼šå°†ä»»åŠ¡å½’è¿˜ç»™è¿›ç¨‹æ± ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡åˆ†å‘ã€‚

**ç”±äºæ˜¯ç›¸åŒä¸”ç‹¬ç«‹ä¸”è€—æ—¶çš„ä»»åŠ¡ï¼Œæ‰€ä»¥å½“æŸä¸ªå·¥ä½œè¿›ç¨‹å®Œæˆä»»åŠ¡æ—¶ï¼Œæˆ‘ä»¬å¾ˆæœ‰å¿…è¦å»æ£€æµ‹æ‰€æœ‰çš„å·¥ä½œè¿›ç¨‹æ˜¯å¦å·²å®Œæˆä»»åŠ¡ï¼Œè€Œä¸åªæ˜¯å¤ç”¨è¿™ä¸ªå·¥ä½œè¿›ç¨‹ï¼Œæˆ‘ä»¬è¦ä¸€æ‰¹ä¸€æ‰¹çš„å¤ç”¨ï¼ï¼ï¼**

**å› ä¸ºå·®ä¸å¤šçš„æ—¶é—´å¼€å§‹æ‰§è¡Œç›¸åŒçš„ä»»åŠ¡ï¼Œå½“ä¸€ä¸ªå·¥ä½œè¿›ç¨‹å®Œæˆæ—¶ï¼Œå®Œå…¨å¯ä»¥ç›¸ä¿¡å…¶ä»–å·¥ä½œè¿›ç¨‹ä¹Ÿå®Œæˆäº†ä»»åŠ¡ï¼Œæ‰€ä»¥æ£€æµ‹ä¸€è½®æ‰€æœ‰çš„å·¥ä½œè¿›ç¨‹ï¼Œè‹¥ç©ºé—²ï¼Œç»™ä»–ä»¬åˆ†é…æ–°ä»»åŠ¡ã€‚**

**æ—¢ç„¶æ˜¯æ‰¹é‡åˆ†é…ä»»åŠ¡ï¼Œå°±ä¸ä¼šå­˜åœ¨åªæœ‰æŸä¸ªå·¥ä½œè¿›ç¨‹åœ¨è¾›è‹¦çš„è¿è¡Œï¼Œå…¶ä»–å·¥ä½œè¿›ç¨‹è¢–æ‰‹æ—ï¼Œå“ˆå“ˆå“ˆå“ˆå“ˆï¼Œæ€»å¾—é›¨éœ²å‡æ²¾å˜›ã€‚**

~~ç”±äºä¸»æ§è¿›ç¨‹å³è¦è´Ÿè´£IPCåˆè¦ä¸æ–­ç›‘å¬æ‰¹ä»»åŠ¡å®Œæˆçš„æƒ…å†µï¼Œç›®å‰æˆ‘é‡‡ç”¨çš„æ–¹å¼æ˜¯setIntervalåˆ‡å‰²ï¼Œè®©IPCå’Œç›‘æ§èƒ½äº¤æ›¿è¿›è¡Œï¼ˆpsï¼šåº”è¯¥æœ‰æ›´å¥½çš„æ–¹æ³•~~

**æˆ‘ä»¬çœŸçš„éœ€è¦setIntervalæ¥å»è½®è¯¢ä»»åŠ¡çŠ¶æ€å—ï¼Œä»€ä¹ˆæ—¶å€™æ‰éœ€è¦è½®è¯¢ä»»åŠ¡çŠ¶æ€ç„¶åè°ƒåº¦ï¼Ÿ**
å·¥ä½œè¿›ç¨‹çŠ¶æ€å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œæ‰æ˜¯æˆ‘ä»¬éœ€è¦å»æ£€æµ‹ä»»åŠ¡çŠ¶æ€å’Œè°ƒåº¦çš„æ—¶æœºï¼›æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ©ç”¨IPCæ¥é€šçŸ¥ä¸»æ§è¿›ç¨‹è¿›è¡Œæ£€æµ‹ä»»åŠ¡çŠ¶æ€å’Œè°ƒåº¦ã€‚
**psï¼šå½“ç„¶ï¼Œè¿˜æœ‰æ›´å¥½çš„æ–¹æ³•ï¼Œå˜¿å˜¿**

## âœ¨ Features

- å¿«

  æŸå¤§å­¦æŸç³»ç»Ÿï¼Œ12000ä¸ªç”¨æˆ·ï¼Œæ¯ä¸ªç”¨æˆ·ç™»é™†éœ€è¦ä¸¤æ¬¡APIè®¿é—®ï¼Œä¸¤æ¬¡APIè®¿é—®ç›´æ¥å¿…é¡»æœ‰0.5sé—´éš”ï¼Œç„¶åå°†ä¿¡æ¯å†™å…¥æ–‡æœ¬ã€‚

  å•çº¿ç¨‹(æœªæµ‹è¯•ï¼Œç†è®ºä¸Š)ï¼š12000*0.5 â€”> **è‡³å°‘éœ€è¦6000s**ã€‚

  è¿›ç¨‹æ± (å·²æµ‹è¯•ï¼Œå®¹é‡ä¸º50çš„è¿›ç¨‹æ± )ï¼š**206s**ï¼Œå¹³å‡æ¯ä¸ªä»»åŠ¡è€—æ—¶17.1ms

  **æ•ˆç‡æå‡ï¼šæ¥è¿‘30å€**

## ğŸ“¦ å®‰è£…

```bash
npm install node-process-pool
```

## ğŸ”¨ä½¿ç”¨

```js
// è¿›ç¨‹æ± ä½¿ç”¨ç¤ºä¾‹
const ProcessPool = require('../src/ProcessPool')
const taskParams = []
for (let i = 0; i < 100; i++) {
  taskParams[i] = [i]
}
// åˆ›å»ºè¿›ç¨‹æ± å®ä¾‹
const processPool = new ProcessPool({
  maxParallelProcess: 50, // æ”¯æŒæœ€å¤§è¿›ç¨‹å¹¶è¡Œæ•°
  timeToClose: 60 * 1000, // å•ä¸ªä»»åŠ¡è¢«æ‰§è¡Œæœ€å¤§æ—¶é•¿
  dependency: `const path = require('path')`, // ä»»åŠ¡è„šæœ¬ä¾èµ–
  workDir: __dirname, // å½“å‰ç›®å½•
  taskName: 'test', // ä»»åŠ¡è„šæœ¬åç§°
  script: async function task(workParam) {
    console.log(workParam)
  }, // ä»»åŠ¡è„šæœ¬å†…å®¹
  taskParams // éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡å‚æ•°åˆ—è¡¨ï¼ŒäºŒç»´æ•°ç»„
})
// åˆ©ç”¨è¿›ç¨‹æ± è¿›è¡Œå¤„ç†å¤§è§„æ¨¡ä»»åŠ¡
processPool.run()
```

## ğŸ¤è´¡çŒ® [![PRs Welcome](https://img.shields.io/badge/PRs-welcome-brightgreen.svg?style=flat-square)](http://makeapullrequest.com)

I welcome all contributions. You can submit any ideas as [pull requests](https://github.com/geniusfunny/node-process-pool/pulls) or as [GitHub issues](https://github.com/geniusfunny/node-process/issues). If you'd like to improve code, please create a Pull Request.
